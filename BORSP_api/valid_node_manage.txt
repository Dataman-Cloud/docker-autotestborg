*** Settings ***
Suite Setup     Get Token
Suite Teardown  Delete All Sessions
Library         Collections
Library         String
Library         OperatingSystem
Library         RequestsLibrary
Library         Collections
Library         XML
Library         json
Library         SSHLibrary
Resource        config.txt

*** Test Cases ***
主机管理-获取集群主机列表
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${resp}=  Get Request  shurenyun  /v1/nodes  headers=${headers}
    Should Be Equal As Strings  ${resp.status_code}  200
    Log  ${resp.text}
    ${nodeip}=  Evaluate  '${resp.json()['data']['masters'][0]['ip']}'
    Set Global Variable  ${nodeip}

主机管理-获取集群监控信息
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${resp}=  Get Request  shurenyun  /v1/metrics/snapshot  headers=${headers}
    Log  ${resp.text}
    Should Be Equal As Strings  ${resp.status_code}  200

主机管理-获取指定主机的信息
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${path}=  Evaluate  '/v1/nodes/'+'${nodeip}'+'/info'
    ${resp}=  Get Request  shurenyun  ${path}  headers=${headers}
    Log  ${resp.text}
    Should Be Equal As Strings  ${resp.status_code}  200

主机管理-获取指定主机的容器列表
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${path}=  Evaluate  '/v1/nodes/'+'${nodeip}'+'/instances'
    ${resp}=  Get Request  shurenyun  ${path}  headers=${headers}
    Should Be Equal As Strings  ${resp.status_code}  200
    Log  ${resp.text}
    ${containerid}=  Evaluate  '${resp.json()['data'][0]['Id']}'
    Set Global Variable  ${containerid}

主机管理-获取指定主机的镜像列表
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${path}=  Evaluate  '/v1/nodes/'+'${nodeip}'+'/images'
    ${resp}=  Get Request  shurenyun  ${path}  headers=${headers}
    Log  ${resp.text}
    Should Be Equal As Strings  ${resp.status_code}  200

主机管理-删除指定主机上的指定镜像
    [Tags]  主机管理
    Open Connection  ${mesosslave}
    Login  ${USERNAME}  ${PASSWORD}
    ${output}=  Execute Command  docker load < /root/alpine.tar
    ${path}=  Evaluate  'v1/nodes/'+'${mesosslave}'+'/images/'+'sha256:4d8dee4f28726c036f35eacd25ec6606d43e39a7252b2f8b328ac3c16509fab1'
    ${resp}=  Delete Request  shurenyun  ${path}  headers=${headers}
    Log  ${resp.text}
    Should Be Equal As Strings  ${resp.status_code}  200

主机管理-获取主机上指定容器的信息
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${path}=  Evaluate  '/v1/nodes/'+'${nodeip}'+'/instances/'+'${containerid}'+'/info'
    ${resp}=  Get Request  shurenyun  ${path}  headers=${headers}
    Log  ${resp.text}
    Should Be Equal As Strings  ${resp.status_code}  200

主机管理-获取主机上服务的状态
    [Tags]  主机管理  ha
    Create Session  shurenyun  ${SERVER}
    ${path}=  Evaluate  '/v1/nodes/'+'${nodeip}'+'/services'
    ${resp}=  Get Request  shurenyun  ${path}  headers=${headers}
    Log  ${resp.text}
    Should Be Equal As Strings  ${resp.status_code}  200

